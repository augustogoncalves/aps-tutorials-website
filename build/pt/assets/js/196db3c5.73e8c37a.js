"use strict";(self.webpackChunkaps_tutorials_website=self.webpackChunkaps_tutorials_website||[]).push([[322],{4137:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(a),m=r,h=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return a?n.createElement(h,i(i({ref:t},p),{},{components:a})):n.createElement(h,i({ref:t},p))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},3378:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var n=a(7462),r=(a(7294),a(4137));const o={},i="Tabela",l={unversionedId:"tutorials/acc-admin/table",id:"tutorials/acc-admin/table",title:"Tabela",description:"Finalmente, estamos prontos para implementar toda a l\xf3gica restante da classe 'Table'.",source:"@site/i18n/pt/docusaurus-plugin-content-docs/current/03-tutorials/05-acc-admin/06-table.mdx",sourceDirName:"03-tutorials/05-acc-admin",slug:"/tutorials/acc-admin/table",permalink:"/pt/tutorials/acc-admin/table",draft:!1,editUrl:"https://github.com/autodesk-platform-services/aps-tutorials-website/edit/master/docs/03-tutorials/05-acc-admin/06-table.mdx",tags:[],version:"current",sidebarPosition:6,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Estrutura da interface do usu\xe1rio",permalink:"/pt/tutorials/acc-admin/ui"},next:{title:"Saiba Mais",permalink:"/pt/learn-more/"}},s={},c=[{value:"Tabela",id:"tabela-1",level:2},{value:"Carregar dados da tabela",id:"carregar-dados-da-tabela",level:2},{value:"CSV File Prepare",id:"csv-file-prepare",level:2},{value:"Experimente",id:"experimente",level:2}],p={toc:c};function d(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"tabela"},"Tabela"),(0,r.kt)("p",null,"Finalmente, estamos prontos para implementar toda a l\xf3gica restante da classe 'Table'.\nA classe 'Table' \xe9 respons\xe1vel por lidar com diferentes tipos de dados, incluindo lista de projetos,\nlista de usu\xe1rios e fornecer as fun\xe7\xf5es, incluindo:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Obtenha a lista de dados do ACC Admin App com base nas informa\xe7\xf5es de entrada atuais."),(0,r.kt)("li",{parentName:"ul"},"Desenhe a lista de dados atual em uma tabela de bootstrap."),(0,r.kt)("li",{parentName:"ul"},"Exportar a lista de dados atual para um arquivo csv."),(0,r.kt)("li",{parentName:"ul"},"Importe os dados de um arquivo csv para o ACC Admin.")),(0,r.kt)("h2",{id:"tabela-1"},"Tabela"),(0,r.kt)("p",null,"Let's start by implementing the Table functionality.\nOpen ",(0,r.kt)("inlineCode",{parentName:"p"},"table.js")," file under the ",(0,r.kt)("inlineCode",{parentName:"p"},"wwwroot")," subfolder, add the implementation code into Class ",(0,r.kt)("inlineCode",{parentName:"p"},"Table"),":\nHere are the explanation of the main function:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"resetData"),": Fetch and setup the data based on the input accountId, projectId, and tabKey. "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"drawTable"),": Draw the bootstrap table with the current data. "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"exportToCSV"),": Export the current data into CSV file."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"importFromCSV"),": Import the information into ACC Admin system from the prepared CSV file.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="wwwroot/table.js"',title:'"wwwroot/table.js"'},"//////////////////////////////////////////////////////////////////////////////////////////////////////////\n//Table class wraps the specific data info\nclass Table {\n    #tableId;\n    #accountId;\n    #projectId;\n    #tabKey;\n    #dataSet;\n    #maxItem;\n    constructor(tableId, accountId = null, projectId = null, tabKey = 'PROJECTS') {\n        this.#tableId = tableId;\n        this.#accountId = accountId;\n        this.#projectId = projectId;\n        this.#tabKey = tabKey;\n        this.#dataSet = null;\n        this.#maxItem = 5;\n    };\n    get tabKey(){\n        return this.#tabKey;\n    }\n    set tabKey( tabKey){\n        this.#tabKey = tabKey;\n    }\n// highlight-start\n    resetData = async( tabKey=null, accountId=null, projectId=null ) =>{\n        this.#tabKey = tabKey? tabKey: this.#tabKey;\n        this.#accountId = accountId? accountId: this.#accountId;\n        this.#projectId = accountId||projectId? projectId: this.#projectId;\n        const url = TABLE_TABS[this.#tabKey].REQUEST_URL;\n        const data = {\n            'accountId': this.#accountId,\n            'projectId': this.#projectId\n        }\n        try {\n            const response = await axios.get(url, { params: data } );\n            this.#dataSet = response.data;\n        } catch (err) {\n            console.error(err);\n            return;\n        }\n        // Mark \"N/A\" for complicated properties.\n        for (var key in this.#dataSet[0]) {\n            if (Array.isArray(this.#dataSet[0][key]) || typeof this.#dataSet[0][key] === 'object' && this.#dataSet[0][key] != null) {\n                this.#dataSet.forEach(item => {\n                    item[key] = \"N/A\";\n                })\n            }\n        }\n    }\n    drawTable = () => {\n        if (this.#dataSet == null || this.#dataSet.length == 0) {\n            console.warn('DataSet is not ready, please fetch your data first.');\n            return;\n        }\n        let columns = [];\n        for (var key in this.#dataSet[0]) {\n            columns.push({\n                field: key,\n                title: key,\n                align: \"center\"\n            })\n        }\n        $(this.#tableId).bootstrapTable('destroy');\n        $(this.#tableId).bootstrapTable({\n            data: this.#dataSet,\n            customToolbarButtons: [\n                {\n                    name: \"grid-export\",\n                    title: \"Export\",\n                    icon: \"glyphicon-export\",\n                    callback: this.exportToCSV\n                },\n                {\n                    name: \"grid-import\",\n                    title: \"Import\",\n                    icon: \"glyphicon-import\",\n                    callback: this.importFromCSV\n                }\n            ],\n            editable: true,\n            clickToSelect: true,\n            cache: false,\n            showToggle: false,\n            pagination: true,\n            pageList: [5],\n            pageSize: 5,\n            pageNumber: 1,\n            uniqueId: 'id',\n            striped: true,\n            search: true,\n            showRefresh: true,\n            minimumCountColumns: 2,\n            smartDisplay: true,\n            columns: columns\n        });\n    }\n    exportToCSV = ()=>{\n        if (this.#dataSet == null || this.#dataSet.length == 0) {\n            console.warn('DataSet is not ready, please fetch your data first.');\n            return;\n        }\n        let csvDataList = [];\n        let csvHeader = [];\n        for (let key in this.#dataSet[0]) {\n            csvHeader.push(key);\n        }\n        csvDataList.push(csvHeader);\n        this.#dataSet.forEach((row) => {\n            let csvRowItem = [];\n            for (let key in row) {\n                if (typeof row[key] === 'string')\n                    csvRowItem.push(\"\\\"\" + row[key].replace(/\\\"/g, \"\\\"\\\"\").replace(\"#\", \"\") + \"\\\"\")\n                else\n                    csvRowItem.push(row[key]);\n            }\n            csvDataList.push(csvRowItem);\n        })\n        let csvString = csvDataList.join(\"%0A\");\n        let a = document.createElement('a');\n        a.href = 'data:attachment/csv,' + csvString;\n        a.target = '_blank';\n        a.download = this.#tabKey + (new Date()).getTime() + '.csv';\n        document.body.appendChild(a);\n        a.click();\n    }\n    importFromCSV = async() => {\n        let input = document.createElement('input');\n        input.type = 'file';\n        input.onchange = _ => {\n            let fileUpload = Array.from(input.files);\n            var regex = /^([a-zA-Z0-9\\s_\\\\.\\-:\\(\\)])+(.csv|.txt)$/;\n            if (regex.test(fileUpload[0].name.toLowerCase())) {\n                if (typeof (FileReader) != \"undefined\") {\n                    var reader = new FileReader();\n                    reader.onload = async (e) => {\n                        function sleep(ms = 0) {\n                            return new Promise(resolve => setTimeout(resolve, ms));\n                        }\n                        $(\"#loadingoverlay\").fadeIn()\n                        const rows = e.target.result.split(\"\\r\\n\");\n                        const keys = rows[0].split(',');\n                        let requestDataList = [];\n                        for (let i = 1; i < rows.length && i <= this.#maxItem; i++) {\n                            let jsonItem = {};\n                            let cells = rows[i].split(\",\");\n                            for (let j = 0; j < cells.length; j++) {\n                                if (cells[j] == null || cells[j] == '')\n                                    continue\n                                // customize the input property\n                                let key = keys[j];\n                                switch (this.#tabKey) {\n                                    case 'PROJECTS':\n                                        if (key == 'template') {\n                                            jsonItem[key] = { 'projectId': cells[j] };\n                                            continue;\n                                        }\n                                        break;\n                                    case 'PROJECT':\n                                    case 'USERS':\n                                        if (key == 'roleIds') {\n                                            const roleIdList = cells[j].replace(/\\s/g, '').split('|');\n                                            jsonItem[key] = roleIdList;\n                                            continue;\n                                        }\n                                        const params = key.split('.')\n                                        const length = params.length;\n                                        if (length == 2 && params[0] == 'products') {\n                                            let productAccess = {\n                                                \"key\": params[length - 1],\n                                                \"access\": cells[j]\n                                            }\n                                            if (jsonItem[\"products\"] == null) {\n                                                jsonItem[\"products\"] = [];\n                                            }\n                                            jsonItem[\"products\"].push(productAccess)\n                                            continue\n                                        }\n                                        break;\n                                    default:\n                                        console.warn(\"The current Admin Data Type is not expected\");\n                                        break;\n                                }\n                                jsonItem[key] = cells[j];\n                            }\n                            requestDataList.push(jsonItem);\n                        }\n                        const data = {\n                            'accountId': this.#accountId,\n                            'projectId': this.#projectId,\n                            'data': requestDataList\n                        }\n                        const url = TABLE_TABS[this.#tabKey].REQUEST_URL;\n                        try {\n                            const resp = await axios.post(url, data);\n                            resp.data.Succeed && resp.data.Succeed.forEach( item => console.log( item + ' is created'));\n                            resp.data.Failed && resp.data.Failed.forEach( item => console.warn( item + ' failed to be created') );\n                            await sleep(3000);\n                            await this.resetData();\n                        } catch (err) {\n                            console.error(err);\n                        }\n                        this.drawTable();\n                        $(\"#loadingoverlay\").fadeOut()\n                    }\n                    reader.readAsText(fileUpload[0]);\n                } else {\n                    alert(\"This browser does not support HTML5.\");\n                }\n            } else {\n                alert(\"Please upload a valid CSV file.\");\n            }\n        };\n        input.click();\n    }    \n// highlight-end\n}\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},'Please note that some complicated properties are just marked as "N/A" to simplify the tutorial,\nand during import, the code will parse the propery information from a CSV file into the request\nbody.')),(0,r.kt)("h2",{id:"carregar-dados-da-tabela"},"Carregar dados da tabela"),(0,r.kt)("p",null,"Agora, vamos concluir a l\xf3gica para carregar os dados dentro das seguintes 2 fun\xe7\xf5es:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"initTableTabs"),(0,r.kt)("li",{parentName:"ul"},"refreshTable")),(0,r.kt)("p",null,"Atualize o c\xf3digo dentro das 2 fun\xe7\xf5es acima modificando 'table.js':"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="wwwroot/table.js"',title:'"wwwroot/table.js"'},'export async function refreshTable( accountId = null, projectId=null ) {\n    showTable(false);\n    if( TABLE_TABS[g_accDataTable.tabKey].TAB_CATEGORY==\'hub\' && projectId ){\n        for (let key in TABLE_TABS) {\n            if( TABLE_TABS[key].TAB_CATEGORY == \'hub\' ){\n                $("#" + key).addClass("hidden");\n                $("#" + key).removeClass("active");\n            }\n            else{\n                if( TABLE_TABS[key].CATEGORY_DEFAULT )\n                    $("#" + key).addClass("active");\n                $("#" + key).removeClass("hidden");\n            }\n        } \n    }\n    if (TABLE_TABS[g_accDataTable.tabKey].TAB_CATEGORY == \'project\' && !projectId) {\n        for (let key in TABLE_TABS) {\n            if (TABLE_TABS[key].TAB_CATEGORY == \'hub\') {\n                $("#" + key).removeClass("hidden");\n                if (TABLE_TABS[key].CATEGORY_DEFAULT)\n                    $("#" + key).addClass("active");\n            }\n            else {\n                $("#" + key).addClass("hidden");\n                $("#" + key).removeClass("active");\n            }\n        }\n    }\n    const activeTab = $("ul#adminTableTabs li.active")[0].id;\n// highlight-start\n    try{\n        await g_accDataTable.resetData( activeTab, accountId, projectId );\n        g_accDataTable.drawTable();\n    }catch(err){\n        console.warn(err);\n    }\n// highlight-end\n    $("#loadingoverlay").fadeOut()\n}\nexport async function initTableTabs(){\n    // add all tabs\n    for (let key in TABLE_TABS) {\n        $(\'<li id=\' + key + \'><a href="accTable" data-toggle="tab">\' + TABLE_TABS[key].TAB_NAME + \'</a></li>\').appendTo(\'#adminTableTabs\');\n        $("#" + key).addClass((TABLE_TABS[key].CATEGORY_NAME == \'hub\' && TABLE_TABS[key].CATEGORY_DEFAULT) ? "active" : "hidden");\n    } \n    // event on the tabs\n    $(\'a[data-toggle="tab"]\').on(\'shown.bs.tab\', async function (e) {\n        $("#loadingoverlay").fadeIn()\n        const activeTab = e.target.parentElement.id;\n// highlight-start\n        try {\n            await g_accDataTable.resetData(activeTab);\n            g_accDataTable.drawTable();\n        } catch (err) {\n            console.warn(err);\n        }    \n// highlight-end\n        $("#loadingoverlay").fadeOut()\n    });  \n}\n')),(0,r.kt)("h2",{id:"csv-file-prepare"},"CSV File Prepare"),(0,r.kt)("p",null,"Finally, the most important feature is batch import projects/users, this is achieved by using a CSV file,\nwe provided 2 template files for projects and users, you can add/modify your information based on the template,\nthen import these data from CSV file into ACC account."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/autodesk-platform-services/aps-acc-admin-tutorial-nodejs/blob/main/template%20files/ProjectsTemplate.csv"},"ProjectsTemplate.csv")," "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/autodesk-platform-services/aps-acc-admin-tutorial-nodejs/blob/main/template%20files/UsersTemplate.csv"},"UsersTemplate.csv"))),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"When import projects to the hub, make sure the ",(0,r.kt)("strong",{parentName:"p"},"Project Name")," prepared in the CSV file\nis not existing in the hub, otherwise, the project can not created due to the name conflicts.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"When import users to the project, the column ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"roleIds"))," of CSV file supports multiple roles for the project user,\nplease use ",(0,r.kt)("strong",{parentName:"p"},'"|"')," as separator.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Se voc\xea abrir o arquivo CSV com o Microsoft Excel, algum tipo de dados ser\xe1 alterado automaticamente pela configura\xe7\xe3o, por exemplo, a coluna de\n",(0,r.kt)("strong",{parentName:"p"},"startDate")," pode ser alterado para o tipo como ",(0,r.kt)("strong",{parentName:"p"},'"2012/03/14"'),", certifique-se de selecionar outro tipo como ",(0,r.kt)("strong",{parentName:"p"},'"2012-03-14"')," sem ",(0,r.kt)("strong",{parentName:"p"},'"/"')," como mostrado na captura de tela,\ncaso contr\xe1rio, a data n\xe3o ser\xe1 reconhecida corretamente ap\xf3s a exporta\xe7\xe3o para o arquivo CSV.")))),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Excel Data Format",src:a(9333).Z,width:"1507",height:"755"})),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"When importing projects, you can always open the ",(0,r.kt)("strong",{parentName:"li"},"Developer Tools")," and check the console\nfor the status of these projects as picture shown below, be noted this only work for importing\nprojects, not work for importing users."))),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Projects Status",src:a(5517).Z,width:"1919",height:"779"})),(0,r.kt)("h2",{id:"experimente"},"Experimente"),(0,r.kt)("p",null,"And that's it! Your application is now ready for action. Start it as usual, and when you go to\n",(0,r.kt)("a",{parentName:"p",href:"http://localhost:8080"},"http://localhost:8080"),", you should be presented with a simple UI, with\na tree-view on the left side, you can do the following operation:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Select an ACC Hub: The table will list all the ACC Projects, you can export all the projects to a CSV file by click\nthe ",(0,r.kt)("inlineCode",{parentName:"li"},"Export")," button, or import the prepared projects by a CSV file with Projects information."),(0,r.kt)("li",{parentName:"ul"},"Select an ACC Project: There are 2 tabs, ",(0,r.kt)("inlineCode",{parentName:"li"},"PROJECT")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"USERS"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"PROJECT")," tab will list the detail information about this\nproject, only export is available, ",(0,r.kt)("inlineCode",{parentName:"li"},"USERS")," tab will list all the project users, you can click the ",(0,r.kt)("inlineCode",{parentName:"li"},"Export")," button to export all\nthe project users to a csv file, or click ",(0,r.kt)("inlineCode",{parentName:"li"},"Import")," button to import users into the selected project with a prepare CSV file of User information.")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Please note that you can only import the certain type of data based on the active Tab, here\nare the details:"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"PROJECTS")," Tab: You can only import project list into the selected account, the csv file needs to follow\nthe Projects template, the csv file of Users template can not be imported. You can check the console to see\nif any projects failed."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"PROJECT")," Tab: Nothing can be imported when this tab is active."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"USERS")," Tab: You can only import user list into the selected project, the csv file needs to follow the Users\ntemplate, Projects template can not be imported. Due to the limitation of Import Project Users API, No information to\ntell if any users are failed to be imported."))),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Final App",src:a(7897).Z,width:"1926",height:"1054"})))}d.isMDXComponent=!0},7897:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/acc-administrator-final-app-a037032ceb35d380fcb0b6d845130dda.webp"},9333:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/excel-data-type-a7a0b889297d21c3854c5ef6ad52af7c.png"},5517:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/projects-status-96d9a190e7e1c05d117f71482aa7193e.png"}}]);